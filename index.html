<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>测试页面</title>
    <script defer src="./krich-es.js" type="module"></script>
    <link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/prism/1.27.0/themes/prism.min.css">
    <script defer src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/prism/1.27.0/components/prism-core.min.js" data-manual></script>
    <script defer src="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/prism/1.27.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script type="module">
        import KRich from './krich-es.js'
        document.addEventListener('DOMContentLoaded', () => {
            const krich = KRich('#krich')
            krich.setHighlight(pre => new Promise(resolve => {
                let language = pre.className
                language = language.substring(language.indexOf('-') + 1)
                Prism.plugins.autoloader.loadLanguages(language, () => {
                    pre.firstChild.innerHTML = Prism.highlight(pre.textContent, Prism.languages[language], language)
                    resolve()
                }, err => {
                    console.error(err)
                    resolve()
                })
            }), () => [
                ['PlainText', 'txt'],
                ['JavaScript', 'js']
            ])
            krich.setImgHandler((element, file) => new Promise(resolve => {
                const reader = new FileReader()
                reader.onload = event => {
                    element.setAttribute('src', event.target.result)
                    resolve()
                }
                reader.readAsDataURL(file)
            }))
            krich.setImageStatusChecker(response => !response.url.includes('403'))
        })
    </script>
</head>
<body>
<div id="krich">

</div>
</body>
</html>